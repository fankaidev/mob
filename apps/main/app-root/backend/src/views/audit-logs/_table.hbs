<div id="audit-logs-container" class="bg-white shadow rounded-lg overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
        <span class="text-sm text-gray-600">
            Total: {{pagination.total}} records
        </span>
        <button
            hx-get="{{buildUrl '/api/htmx/audit-logs/table' page=pagination.page pageSize=pagination.pageSize tableName=filters.tableName action=filters.action recordId=filters.recordId userId=filters.userId traceId=filters.traceId startDate=filters.startDate endDate=filters.endDate}}"
            hx-target="#audit-logs-container"
            class="text-sm text-blue-600 hover:text-blue-800"
        >
            Refresh
        </button>
    </div>

    {{#if logs.length}}
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Table</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Record ID</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User ID</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trace ID</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Changes</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {{#each logs}}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm text-gray-900 whitespace-nowrap">
                        {{formatDate changedAt}}
                    </td>
                    <td class="px-4 py-3 text-sm">
                        <code class="bg-gray-100 px-2 py-1 rounded">{{tableName}}</code>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500 font-mono text-xs">
                        {{recordId}}
                    </td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-medium {{#if (eq action 'INSERT')}}bg-green-100 text-green-800{{else if (eq action 'UPDATE')}}bg-yellow-100 text-yellow-800{{else if (eq action 'DELETE')}}bg-red-100 text-red-800{{else}}bg-gray-100 text-gray-800{{/if}}">
                            {{action}}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500 font-mono text-xs">
                        {{#if userId}}{{userId}}{{else}}-{{/if}}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500 font-mono text-xs">
                        {{#if traceId}}{{traceId}}{{else}}-{{/if}}
                    </td>
                    <td class="px-4 py-3">
                        {{#if (eq action 'INSERT')}}
                            <pre class="text-xs bg-green-50 p-2 rounded overflow-x-auto max-w-md">{{json newData}}</pre>
                        {{else if (eq action 'DELETE')}}
                            <pre class="text-xs bg-red-50 p-2 rounded overflow-x-auto max-w-md">{{json oldData}}</pre>
                        {{else if (eq action 'UPDATE')}}
                            {{!-- Simplified diff logic for Handlebars --}}
                            <div class="text-xs space-y-1 max-w-md">
                                <details>
                                    <summary class="cursor-pointer text-blue-600">View Changes</summary>
                                    <div class="mt-2 space-y-2">
                                        <div class="p-2 bg-red-50 rounded">
                                            <div class="font-bold text-red-800 mb-1">Old Data:</div>
                                            <pre class="overflow-x-auto">{{json oldData}}</pre>
                                        </div>
                                        <div class="p-2 bg-green-50 rounded">
                                            <div class="font-bold text-green-800 mb-1">New Data:</div>
                                            <pre class="overflow-x-auto">{{json newData}}</pre>
                                        </div>
                                    </div>
                                </details>
                            </div>
                        {{else}}
                            <span class="text-gray-400">-</span>
                        {{/if}}
                    </td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div class="p-6 text-center text-gray-500">
        No audit logs found
    </div>
    {{/if}}

    <div class="px-6 py-4 border-t border-gray-200">
        {{> audit-logs/_pagination }}
    </div>
</div>
